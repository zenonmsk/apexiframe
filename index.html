<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trình xem Ứng dụng APEX</title>
    <!-- Tải Tailwind CSS để styling nhanh và responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Thiết lập font Inter -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Màu nền nhẹ */
        }
        /* Đảm bảo iframe chiếm toàn bộ không gian có thể */
        #apex-iframe-container {
            /* Chiều cao trừ đi header, margin và button bar (3.5rem) */
            height: calc(100vh - 6rem - 3.5rem); 
            min-height: 400px;
        }
        @media (max-width: 768px) {
            #apex-iframe-container {
                /* Header và button bar nhỏ hơn trên mobile */
                height: calc(100vh - 4rem - 3.5rem); 
            }
        }
        /* Style cho thẻ <a> để trông giống nút */
        .btn {
            display: inline-block;
            text-align: center;
            line-height: 1.25; /* Thêm line-height cho căn giữa tốt hơn */
            cursor: pointer;
            transition: all 150ms ease-in-out;
            text-decoration: none; /* Loại bỏ gạch chân của link */
        }
    </style>
</head>
<body class="min-h-screen antialiased">

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        
        <!-- Header / Tiêu đề -->
        <header class="mb-4 bg-white p-4 rounded-lg shadow-md flex justify-between items-center">
            <h1 class="text-2xl font-bold text-indigo-700">Trình xem Ứng dụng APEX</h1>
            <!-- Đã loại bỏ Native Status vì không sử dụng Native Bridge -->
            <span class="text-sm text-gray-500 hidden sm:block">Sử dụng Custom URL Scheme</span>
        </header>

        <!-- Container chính -->
        <main class="bg-white rounded-lg shadow-xl p-0 overflow-hidden">
            
            <!-- Thanh Công cụ và Thông báo -->
            <div class="p-4 border-b border-gray-100 flex flex-col sm:flex-row justify-between items-center gap-3">
                 <div id="loading-message" class="text-center text-sm text-gray-600">
                    Đang tải ứng dụng Oracle APEX...
                </div>

                <div class="flex flex-row gap-3 w-full sm:w-auto">
                    <!-- NÚT QUAY LẠI TRANG TRƯỚC (Cục bộ) -->
                    <button 
                        onclick="window.history.back()"
                        class="px-4 py-2 bg-gray-300 text-gray-700 font-semibold rounded-lg shadow-md hover:bg-gray-400 transition duration-150 ease-in-out text-sm w-1/2 sm:w-auto"
                        title="Quay lại lịch sử trang trước trong WebView (ví dụ: từ trang đăng nhập về trang chính)"
                    >
                        Quay lại trang trước
                    </button>
                    
                    <!-- NÚT MỞ LINK TRÊN TRÌNH DUYỆT GỐC (Dùng thẻ A) -->
                    <!-- 
                        Thẻ A này chỉ sử dụng thuộc tính href với Custom Scheme (app-bridge://)
                        và dựa vào Native App (WebView) để chặn và xử lý nó.
                    -->
                    <a 
                        id="open-browser-button"
                        href="app-bridge://open-external?url=https%3A%2F%2Fdocs.oracle.com%2Fen%2Fdatabase%2Foracle%2Fapex%2F"
                        class="btn px-4 py-2 bg-pink-500 text-white font-semibold rounded-lg shadow-md hover:bg-pink-600 transition duration-150 ease-in-out text-sm w-1/2 sm:w-auto"
                        title="Mở link ngoài bằng trình duyệt hệ thống (Safari/Chrome)"
                    >
                        Mở Link Ngoài
                    </a>
                </div>
            </div>


            <!-- Iframe chứa ứng dụng APEX -->
            <div id="apex-iframe-container" class="w-full relative">
                <!-- 
                    *** RẤT QUAN TRỌNG: THAY THẾ URL DƯỚI ĐÂY BẰNG URL APEX CỦA BẠN ***
                -->
                <iframe 
                    id="apex-app-frame"
                    src="YOUR_APEX_APPLICATION_URL_HERE" 
                    frameborder="0" 
                    class="w-full h-full"
                    title="Ứng dụng Oracle APEX được nhúng"
                    sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-pointer-lock"
                ></iframe>
            </div>

            <!-- Footer / Chân trang -->
            <footer class="p-3 text-center text-xs text-gray-400 bg-gray-50 border-t border-gray-100">
                Sử dụng iframe để tích hợp các ứng dụng web.
            </footer>

        </main>
    </div>

    <script>
        const EXTERNAL_URL = 'https://docs.oracle.com/en/database/oracle/apex/'; 
        const BROWSER_BUTTON = document.getElementById('open-browser-button');
        const LOADING_MESSAGE = document.getElementById('loading-message');

        document.addEventListener('DOMContentLoaded', function() {
            const iframe = document.getElementById('apex-app-frame');

            // --- Thiết lập URL cho nút Mở Link Ngoài ---
            // Đảm bảo URL luôn được mã hóa đúng cách cho thuộc tính href
            const encodedUrl = encodeURIComponent(EXTERNAL_URL);
            BROWSER_BUTTON.href = `app-bridge://open-external?url=${encodedUrl}`;

            // Ẩn thông báo tải khi iframe tải xong
            iframe.onload = function() {
                LOADING_MESSAGE.classList.add('hidden');
            };

            // Cảnh báo nếu URL chưa được thay đổi
            if (iframe.src.includes("https://oracleapex.com/ords/r/ttdat/test")) {
                LOADING_MESSAGE.innerHTML = '⚠️ **LỖI:** Vui lòng thay thế placeholder `YOUR_APEX_APPLICATION_URL_HERE` trong mã nguồn bằng URL APEX thực tế của bạn.';
                LOADING_MESSAGE.classList.remove('text-gray-600');
                LOADING_MESSAGE.classList.add('text-red-600', 'font-bold');
                
                // Vô hiệu hóa nút Mở Link Ngoài nếu chưa có URL APEX
                BROWSER_BUTTON.classList.add('opacity-50', 'pointer-events-none');
            } else {
                 console.warn("Lưu ý: Nếu bạn gặp lỗi 'redirected too many times', vấn đề nằm ở cấu hình Xác thực (Authentication Scheme) của ứng dụng APEX.");
            }
        });
    </script>
    
</body>
</html>
